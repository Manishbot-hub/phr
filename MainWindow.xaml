<Window x:Class="PharmacyManagementApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Pharmacy Management System" Height="820" Width="1360"
        MinWidth="1150" MinHeight="700" WindowStartupLocation="CenterScreen">
    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Control" Command="ApplicationCommands.New"/>
        <KeyBinding Key="S" Modifiers="Control" Command="ApplicationCommands.Save"/>
        <KeyBinding Key="Delete" Modifiers="Control" Command="ApplicationCommands.Delete"/>
        <KeyBinding Key="F" Modifiers="Control" Command="ApplicationCommands.Find"/>
        <KeyBinding Key="F5" Command="NavigationCommands.Refresh"/>
    </Window.InputBindings>

    <DockPanel LastChildFill="True" Background="#EEF2F7">
        <Menu DockPanel.Dock="Top" Background="White" Padding="6">
            <MenuItem Header="_File">
                <MenuItem Header="_New Item\tCtrl+N" Command="ApplicationCommands.New"/>
                <MenuItem Header="_Save\tCtrl+S" Command="ApplicationCommands.Save"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="_Actions">
                <MenuItem Header="_Delete Item\tCtrl+Del" Command="ApplicationCommands.Delete"/>
                <MenuItem Header="_Find\tCtrl+F" Command="ApplicationCommands.Find"/>
                <MenuItem Header="_Refresh\tF5" Command="NavigationCommands.Refresh"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="Keyboard _Shortcuts" Click="Shortcuts_Click"/>
            </MenuItem>
        </Menu>

        <Grid Margin="14">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Border Background="White" CornerRadius="10" Padding="16" Margin="0,0,0,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Pharmacy Management Dashboard" FontWeight="Bold" FontSize="24" Foreground="#1F2A44"/>
                        <TextBlock Text="Single-window workflow for inventory, sales, prescriptions, suppliers, and reports." Foreground="#5C677D" Margin="0,5,0,0"/>
                    </StackPanel>

                    <Border Grid.Column="1" Background="#E7F1FF" CornerRadius="8" Margin="8,0,8,0" Padding="12">
                        <StackPanel>
                            <TextBlock Text="Today Sales" FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding TodaySales, StringFormat=C}" FontSize="20" FontWeight="Bold" Foreground="#0B5ED7"/>
                        </StackPanel>
                    </Border>

                    <Border Grid.Column="2" Background="#E8F8F2" CornerRadius="8" Margin="8,0,8,0" Padding="12">
                        <StackPanel>
                            <TextBlock Text="Low Stock Items" FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding LowStockCount}" FontSize="20" FontWeight="Bold" Foreground="#198754"/>
                        </StackPanel>
                    </Border>

                    <Border Grid.Column="3" Background="#FFF4E5" CornerRadius="8" Margin="8,0,0,0" Padding="12">
                        <StackPanel>
                            <TextBlock Text="Expiring in 30 days" FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding ExpiringSoonCount}" FontSize="20" FontWeight="Bold" Foreground="#B35C00"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <TabControl Grid.Row="1" Background="White" Padding="8">
                <TabItem Header="_Inventory">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <WrapPanel>
                            <Label Content="Drug _Name" Target="{Binding ElementName=DrugNameTextBox}"/>
                            <TextBox x:Name="DrugNameTextBox" Width="220" Text="{Binding CurrentMedicine.Name, UpdateSourceTrigger=PropertyChanged}"/>
                            <Label Content="_Category" Target="{Binding ElementName=CategoryTextBox}"/>
                            <TextBox x:Name="CategoryTextBox" Width="150" Text="{Binding CurrentMedicine.Category, UpdateSourceTrigger=PropertyChanged}"/>
                            <Label Content="_Batch #" Target="{Binding ElementName=BatchTextBox}"/>
                            <TextBox x:Name="BatchTextBox" Width="120" Text="{Binding CurrentMedicine.BatchNumber, UpdateSourceTrigger=PropertyChanged}"/>
                            <Label Content="_Expiry" Target="{Binding ElementName=ExpiryDatePicker}"/>
                            <DatePicker x:Name="ExpiryDatePicker" Width="145" SelectedDate="{Binding CurrentMedicine.ExpiryDate}"/>
                            <Label Content="_Stock" Target="{Binding ElementName=StockTextBox}"/>
                            <TextBox x:Name="StockTextBox" Width="85" Text="{Binding CurrentMedicine.StockQuantity, UpdateSourceTrigger=PropertyChanged}"/>
                            <Label Content="_Reorder" Target="{Binding ElementName=ReorderTextBox}"/>
                            <TextBox x:Name="ReorderTextBox" Width="85" Text="{Binding CurrentMedicine.ReorderLevel, UpdateSourceTrigger=PropertyChanged}"/>
                            <Label Content="_Price" Target="{Binding ElementName=PriceTextBox}"/>
                            <TextBox x:Name="PriceTextBox" Width="95" Text="{Binding CurrentMedicine.UnitPrice, UpdateSourceTrigger=PropertyChanged, StringFormat=F2}"/>
                        </WrapPanel>

                        <WrapPanel Grid.Row="1" Margin="0,8,0,8">
                            <Button Content="Add / Update (Ctrl+S)" Command="ApplicationCommands.Save" Background="{StaticResource PrimaryBrush}" Foreground="White"/>
                            <Button Content="New (Ctrl+N)" Command="ApplicationCommands.New"/>
                            <Button Content="Delete (Ctrl+Del)" Command="ApplicationCommands.Delete" Background="#DC3545" Foreground="White"/>
                            <Button Content="Find (Ctrl+F)" Command="ApplicationCommands.Find"/>
                            <TextBox Width="220" Text="{Binding InventoryFilter, UpdateSourceTrigger=PropertyChanged}" ToolTip="Type to filter by medicine name or category"/>
                        </WrapPanel>

                        <DataGrid Grid.Row="2" ItemsSource="{Binding FilteredMedicines}" SelectedItem="{Binding SelectedMedicine, Mode=TwoWay}"
                                  AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False"
                                  AlternationCount="2" AlternatingRowBackground="#F7FAFF">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Medicine" Binding="{Binding Name}" Width="2*"/>
                                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="*"/>
                                <DataGridTextColumn Header="Batch" Binding="{Binding BatchNumber}" Width="*"/>
                                <DataGridTextColumn Header="Expiry" Binding="{Binding ExpiryDate, StringFormat=d}" Width="*"/>
                                <DataGridTextColumn Header="Stock" Binding="{Binding StockQuantity}" Width="*"/>
                                <DataGridTextColumn Header="Reorder" Binding="{Binding ReorderLevel}" Width="*"/>
                                <DataGridTextColumn Header="Unit Price" Binding="{Binding UnitPrice, StringFormat=C}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>

                <TabItem Header="_Sales & Billing">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <WrapPanel>
                            <Label Content="_Customer"/>
                            <TextBox Width="220" Text="{Binding SaleCustomerName, UpdateSourceTrigger=PropertyChanged}"/>
                            <Label Content="_Medicine"/>
                            <ComboBox Width="220" DisplayMemberPath="Name" ItemsSource="{Binding Medicines}" SelectedItem="{Binding SelectedSaleMedicine}"/>
                            <Label Content="_Qty"/>
                            <TextBox Width="80" Text="{Binding SaleQuantity, UpdateSourceTrigger=PropertyChanged}"/>
                            <Button Content="Add To Bill" Click="AddToBill_Click" Background="{StaticResource AccentBrush}" Foreground="White"/>
                            <Button Content="Complete Sale" Click="CompleteSale_Click" Background="{StaticResource PrimaryBrush}" Foreground="White"/>
                            <Button Content="Clear" Click="ClearBill_Click"/>
                        </WrapPanel>

                        <Grid Grid.Row="1" Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="3*"/>
                                <ColumnDefinition Width="2*"/>
                            </Grid.ColumnDefinitions>

                            <DataGrid ItemsSource="{Binding BillItems}" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Medicine" Binding="{Binding MedicineName}" Width="2*"/>
                                    <DataGridTextColumn Header="Quantity" Binding="{Binding Quantity}" Width="*"/>
                                    <DataGridTextColumn Header="Unit Price" Binding="{Binding UnitPrice, StringFormat=C}" Width="*"/>
                                    <DataGridTextColumn Header="Line Total" Binding="{Binding LineTotal, StringFormat=C}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>

                            <StackPanel Grid.Column="1" Margin="16,0,0,0">
                                <Border Background="#F8F9FA" CornerRadius="8" Padding="12" Margin="0,0,0,10">
                                    <StackPanel>
                                        <TextBlock Text="Invoice Summary" FontWeight="Bold" FontSize="16"/>
                                        <TextBlock Text="Subtotal" Margin="0,8,0,0"/>
                                        <TextBlock Text="{Binding BillSubtotal, StringFormat=C}" FontSize="18" FontWeight="Bold"/>
                                        <TextBlock Text="Tax (5%)" Margin="0,8,0,0"/>
                                        <TextBlock Text="{Binding BillTax, StringFormat=C}"/>
                                        <TextBlock Text="Total" Margin="0,8,0,0"/>
                                        <TextBlock Text="{Binding BillTotal, StringFormat=C}" FontSize="20" FontWeight="Bold" Foreground="#0B5ED7"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="#FFF8E1" CornerRadius="8" Padding="12">
                                    <StackPanel>
                                        <TextBlock Text="Quick Tips" FontWeight="SemiBold"/>
                                        <TextBlock Text="• Ctrl+S: Save item" Margin="0,6,0,0"/>
                                        <TextBlock Text="• Ctrl+F: Search inventory"/>
                                        <TextBlock Text="• F5: Refresh dashboard"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </TabItem>

                <TabItem Header="_Suppliers & Prescriptions">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <GroupBox Header="Supplier Contacts" Margin="0,0,8,0" Padding="8">
                            <DockPanel>
                                <WrapPanel DockPanel.Dock="Top">
                                    <TextBox Width="180" Text="{Binding NewSupplierName}" ToolTip="Supplier name"/>
                                    <TextBox Width="200" Text="{Binding NewSupplierPhone}" ToolTip="Phone"/>
                                    <TextBox Width="220" Text="{Binding NewSupplierEmail}" ToolTip="Email"/>
                                    <Button Content="Add Supplier" Click="AddSupplier_Click"/>
                                </WrapPanel>
                                <DataGrid ItemsSource="{Binding Suppliers}" AutoGenerateColumns="False" CanUserAddRows="False" Margin="0,8,0,0">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="2*"/>
                                        <DataGridTextColumn Header="Phone" Binding="{Binding Phone}" Width="*"/>
                                        <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="2*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </DockPanel>
                        </GroupBox>

                        <GroupBox Grid.Column="1" Header="Prescription Queue" Margin="8,0,0,0" Padding="8">
                            <DockPanel>
                                <WrapPanel DockPanel.Dock="Top">
                                    <TextBox Width="150" Text="{Binding NewPrescriptionPatient}" ToolTip="Patient"/>
                                    <TextBox Width="180" Text="{Binding NewPrescriptionDoctor}" ToolTip="Doctor"/>
                                    <ComboBox Width="180" DisplayMemberPath="Name" ItemsSource="{Binding Medicines}" SelectedItem="{Binding NewPrescriptionMedicine}"/>
                                    <Button Content="Add Prescription" Click="AddPrescription_Click" Background="{StaticResource AccentBrush}" Foreground="White"/>
                                </WrapPanel>
                                <DataGrid ItemsSource="{Binding Prescriptions}" AutoGenerateColumns="False" CanUserAddRows="False" Margin="0,8,0,0">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Patient" Binding="{Binding PatientName}" Width="*"/>
                                        <DataGridTextColumn Header="Doctor" Binding="{Binding DoctorName}" Width="*"/>
                                        <DataGridTextColumn Header="Medicine" Binding="{Binding MedicineName}" Width="*"/>
                                        <DataGridTextColumn Header="Date" Binding="{Binding CreatedOn, StringFormat=g}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </DockPanel>
                        </GroupBox>
                    </Grid>
                </TabItem>
            </TabControl>

            <StatusBar Grid.Row="2" Background="White" Margin="0,10,0,0">
                <StatusBarItem Content="Ready"/>
                <Separator/>
                <StatusBarItem Content="{Binding CurrentDateTime, StringFormat='{}{0:dddd, dd MMM yyyy HH:mm}'}"/>
                <Separator/>
                <StatusBarItem Content="{Binding FooterMessage}"/>
            </StatusBar>
        </Grid>
    </DockPanel>
</Window>
